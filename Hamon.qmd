---
title: "Hamon"
format: html
editor: visual
---

The link to my GitHub repository is : https://github.com/hamoco20/eval-grades.git

```{r}
here::i_am("final graded lab.Rproj")
library(here)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(lubridate)
```

# Introduction

## Study Organisation

Question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

Question 2

```{r}
courses |>
  rename(
    `course name` = course,
    identifier = course_id,
    `number of exams` = nb_grades
  ) |>
  arrange(`course name`) |>
  knitr::kable()
```

## Students

Question 3

```{r}
students <- vroom(
  here("data", "students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_integer(),
    birth_date = col_date(),
    sex = col_factor()
  )
)
students
```

## Grades

Question 4

```{r}
grades <- vroom(
  here("data", "grades.csv"),
  delim = ";",
  na = "$",
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)
grades
```

# Student population analysis

Question 5

```{r}
students |>
  count(group) |>
  arrange(group) |>
  ggplot(aes(x = group, y=n)) +
  geom_col()
```

Question 6

```{r}
students |>
  count(group, sex) |>
  arrange(group) |>
  ggplot(aes(x = factor(group), y = n, fill = sex)) +
  geom_col() +
  labs(
    title = "gender balance in groups"
  )
```

Question 7

```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  )

students <- students |>
  mutate(
    age = round(age)
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color="white") +
  labs(
    title = "distribution of students' ages",
    x = "age in years",
    y = "nb of students"
  )
```

Question 8

```{r}
students |>
  group_by(group) |>
  summarize(
    median_age = median(age)
    ) |>
  arrange(group) |>
  knitr::kable()
```

Question 9

```{r}
students |>
  group_by(group) |>
  slice_max(order_by = age, n=1, with_ties = FALSE) |>
  select(id, sex, age, group) |>                  
  arrange(desc(age)) |>
  knitr::kable() 
```

Question 10 
The data set contains `r sum(!is.na(grades$grade))` grades.

Question 11
```{r}
courses |>
  filter(course == "Divine Philosophy and Ethics") |>
  pull(course_id)

divine_grades <- grades |>
  filter(course_id == 1) |>
  inner_join(students, by = "id")

divine_grades |>
  group_by(group) |>
  summarize(avg_grade = mean(grade, na.rm = TRUE)) |>
  arrange(group) |>
  ggplot(aes(x = factor(group), y = avg_grade)) +
  geom_col(fill = "skyblue") +
   labs(
    title = "average grade in divine philosophy and ethics by group")
```

Question 12
```{r}
grades |>
  filter(!is.na(grade)) |>                
  inner_join(courses |> select(course_id, module), by = "course_id") |>  
  mutate(module = factor(module)) |>
           ggplot(aes(x = grade, fill = module)) +
  geom_density(alpha = 0.4) +              
  labs(
    title = "distribution of grades by module",
    x = "grade",
    y = "density",
    fill = "module"
  ) 
```
Module 2 seems to have the highest grades overall because of its right-wing position and an average above 10 compared to the the module 1 where grades seems more heterogenous but lower on average. So, module 1 seems to be more difficult than 2 and 3.

# Attendance analysis

Question 13
```{r}
grades |>
  filter(!is.na(grade)) |>
  group_by(id) |>
  summarize(nb_grades = n(), .groups = "drop") |>
  inner_join(students, by = "id") |>
  slice_head(n = 10) |>
  knitr::kable(caption = "nb of grades per student (Sample)")

```

